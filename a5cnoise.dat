STATE ZERO     = 000000470080000000000000000000000000000008000000111111111111111100800000FF000000000000000000000000000000000000000000000012201300000000000300000000006CC300001CC3000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000
STATE HEADDIR  = 00AAFA4633B3080000000000000000000000000009F00084111111111111111100800000F00000000000000000000000FA000000FA00000033030000122013000000000003000000B08F2AC917D8FFC8000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000
STATE HEADRLY  = 00AAFA4600C018000000000000000000000000008AF00080111111111111111100800000F00000000000000000000000E8030000D007000033030000122013000000000003000000B08F2AC917D8FFC8000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000
STATE HEADNOI  = 00AAFA4633B3000000000000000000000000000008F00080000000000000000000800000F01800000000000000000000FA000000FA00000033030000122013000000000003000000B08F2AC917D8FFC8000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000

  MESSAGE ""
  MESSAGE "This file tests noise of the on-head boards caused by motor"
  MESSAGE "drivers. Low quality electrolytic capacitors on some Y-Z"
  MESSAGE "drivers result in electric disturbances, which may influence"
  MESSAGE "capacity measurements. If there are messages in red, we"
  MESSAGE "recommend to repair or replace corresponding drivers!"
  MESSAGE ""
  SOFTRESET
START:

  MESSAGE "Testing direct connection mode of heads..."
  FIRSTHEAD
HEADDIR:
  SET     HEADDIR HEAD=DIR,UI,MINUS,PLUS,GND
  DELAY   30
  VOLTAGE -11.000 -9.500 ERROR "Head #H: shortcut or always in amplifier mode"
  SET     HEADDIR HEAD=I,UI,MINUS,PLUS,GND
  DELAY   50
  VOLTAGE -1.000 1.000 ERROR "Head #H: absent on-head board or always direct connection"
  NEXTHEAD HEADDIR

  MESSAGE "Testing multiplexer relays..."
  FIRSTHEAD
HEADRLY:
  SET     HEADRLY
  DELAY   20
  FIXPHASE
  SET     HEADRLY HEAD=DIR,UI
  PHASE   -0.010 0.010 SUCCESS "#U (OH_UI at #H) does not reswitch"
  SET     HEADRLY HEAD=DIR,MINUS
  PHASE   -0.010 0.010 SUCCESS "#M (OH_MINUS at #H) does not reswitch"
  SET     HEADRLY HEAD=DIR,PLUS
  PHASE   -0.010 0.010 SUCCESS "#P (OH_PLUS at #H) does not reswitch"
  SET     HEADRLY HEAD=DIR,GND
  PHASE   -0.010 0.010 SUCCESS "#G (OH_GND at #H) does not reswitch"
  NEXTHEAD HEADRLY

  MESSAGE "Testing noise of capacity measurements..."
  MESSAGE ""
  FIRSTHEAD
HEADNOI:
  SET     HEADNOI HEAD=I,UI,MINUS,PLUS,GND
  DELAY   100
  MEMZERO 1
  MEMZERO 2
  // First step.
  MOVEHEAD 0.0,-4.0
  FFT
  FFTMAX  50000 100000
  MEMMAX 1
  FFTMAX  100000 400000
  MEMMAX 2
  // Second step.
  MOVEHEAD 0.0,-3.0
  FFT
  FFTMAX  50000 100000
  MEMMAX 1
  FFTMAX  100000 400000
  MEMMAX 2
  // Third step.
  MOVEHEAD 0.0,-2.0
  FFT
  FFTMAX  50000 100000
  MEMMAX 1
  FFTMAX  100000 400000
  MEMMAX 2
  // Fourth step.
  MOVEHEAD 0.0,-1.0
  FFT
  FFTMAX  50000 100000
  MEMMAX 1
  FFTMAX  100000 400000
  MEMMAX 2
  // Fifth step.
  MOVEHEAD 0.0,0.0
  FFT
  FFTMAX  50000 100000
  MEMMAX 1
  FFTMAX  100000 400000
  MEMMAX 2
  // Sixth step.
  MOVEHEAD 0.0,1.0
  FFT
  FFTMAX  50000 100000
  MEMMAX 1
  FFTMAX  100000 400000
  MEMMAX 2
  // Seventh step.
  MOVEHEAD 0.0,2.0
  FFT
  FFTMAX  50000 100000
  MEMMAX 1
  FFTMAX  100000 400000
  MEMMAX 2
  // Eighth step.
  MOVEHEAD 0.0,3.0
  FFT
  FFTMAX  50000 100000
  MEMMAX 1
  FFTMAX  100000 400000
  MEMMAX 2
  // Ninth step.
  MOVEHEAD 0.0,4.0
  FFT
  FFTMAX  50000 100000
  MEMMAX 1
  FFTMAX  100000 400000
  MEMMAX 2
  MOVEHEAD HOME
  // Analyse lower frequency range.
  MEMGET 1
  LIMITS  -1000.0 25.0 ERROR WARN82
  MESSAGE "Head #H  Noise  50..100 kHz = #V a.u."
  GOTO END82
WARN82:
  LIMITS  -1000.0 50.0 ERROR BAD82
  MESSAGE "Head #H  Noise  50..100 kHz = #V a.u. - NOISY"
  GOTO END82
BAD82:
  WARNING "Head #H  Noise  50..100 kHz = #V a.u. - HIGH NOISE"
END82:
  // Analyse highet frequency range.
  MEMGET 2
  LIMITS  -1000.0 35.0 ERROR WARN100
  MESSAGE "         Noise 100..400 kHz = #V a.u."
  GOTO END100
WARN100:
  LIMITS  -1000.0 70.0 ERROR BAD100
  MESSAGE "         Noise 100..400 kHz = #V a.u. - NOISY"
  GOTO END100
BAD100:
  WARNING "Head #H  Noise 100..400 kHz = #V a.u. - HIGH NOISE"
END100:
  MESSAGE ""
  NEXTHEAD HEADNOI

  REPEAT  START

FINISH:
  SET     ZERO
  MESSAGE "Test finished."
  STOP

